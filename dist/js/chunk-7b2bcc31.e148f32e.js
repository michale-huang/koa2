(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b2bcc31"],{3893:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"role"},[t._m(0),a("div",{staticClass:"content"},[a("div",{staticClass:"tree"},[a("Tree",{attrs:{data:t.treeData,render:t.positionRender,"children-key":"treeList"},on:{"on-select-change":t.selectChange}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showRoleAccount,expression:"showRoleAccount"}],staticClass:"account"},[a("Table",{attrs:{stripe:"",columns:t.roleAccountColumns,data:t.roleAccountData},scopedSlots:t._u([{key:"phone",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.internationalPhonePrefix+" "+a.phoneNumber)+" ")]}},{key:"accountStatus",fn:function(e){var a=e.row;return[t._v(" "+t._s("enable"===a.accountStatus?"可用":"不可用")+" ")]}}])})],1)]),a("adt-reconfirm-modal",{attrs:{showModal:t.showDeleteModal},on:{"on-visible-change":t.deleteVisibleChange,"on-ok":t.handleDeleteModalOk}}),a("adt-my-modal",{attrs:{showModal:t.showItemModal,title:t.itemTitle,width:"80%"},on:{"on-visible-change":t.visibleChange,"on-ok":t.handleItemModalOk}},[a("Form",{ref:"formValidate",attrs:{model:t.itemData,rules:t.ruleValidate,"label-colon":!0,"label-position":"left","label-width":120}},[t.showType?a("FormItem",{attrs:{label:"新增项",prop:"type"}},[a("RadioGroup",{on:{"on-change":t.changeItem},model:{value:t.itemData.type,callback:function(e){t.$set(t.itemData,"type",e)},expression:"itemData.type"}},[a("Radio",{attrs:{label:"1"}},[t._v(" 岗位 ")]),a("Radio",{staticStyle:{"margin-left":"30px"},attrs:{label:"2"}},[t._v(" 帐户 ")])],1)],1):t._e(),a("div",{staticClass:"line"}),"1"!==t.itemData.type&&t.showType?t._e():[a("FormItem",{attrs:{label:"岗位名称",prop:"roleName"}},[a("Input",{staticStyle:{width:"190px"},model:{value:t.itemData.roleName,callback:function(e){t.$set(t.itemData,"roleName",e)},expression:"itemData.roleName"}})],1),a("FormItem",{attrs:{label:"岗位状态",prop:"roleStatus"}},[a("Select",{staticStyle:{width:"190px"},model:{value:t.itemData.roleStatus,callback:function(e){t.$set(t.itemData,"roleStatus",e)},expression:"itemData.roleStatus"}},[a("Option",{attrs:{value:"enable"}},[t._v("可用")]),a("Option",{attrs:{value:"disable"}},[t._v("不可用")])],1)],1),a("FormItem",{attrs:{label:"岗位描述",prop:"roleDescribe"}},[a("Input",{staticStyle:{width:"50%"},attrs:{type:"textarea"},model:{value:t.itemData.roleDescribe,callback:function(e){t.$set(t.itemData,"roleDescribe",e)},expression:"itemData.roleDescribe"}})],1)],"2"===t.itemData.type?[a("Table",{attrs:{stripe:"",columns:t.accountColumns,data:t.accountData},on:{"on-selection-change":t.selectAccount},scopedSlots:t._u([{key:"accountType",fn:function(e){var n=e.row,o=e.index;return[a("Select",{on:{"on-change":function(e){return t.chooseAccountType(n,o)}},model:{value:n.accountType,callback:function(e){t.$set(n,"accountType",e)},expression:"row.accountType"}},[a("Option",{attrs:{value:"1"}},[t._v("类型1")]),a("Option",{attrs:{value:"2"}},[t._v("类型2")])],1)]}},{key:"phone",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.internationalPhonePrefix+" "+a.phoneNumber)+" ")]}},{key:"accountStatus",fn:function(e){var a=e.row;return[t._v(" "+t._s("enable"===a.accountStatus?"可用":"不可用")+" ")]}}],null,!1,1151818893)})]:t._e()],2)],1),a("adt-my-modal",{attrs:{showModal:t.showPermissionModal,title:t.permissionTitle},on:{"on-ok":t.handlePermissionModalOk,"on-visible-change":t.permissionVisibleChange}},[a("ul",{staticClass:"position-info"},[a("li",[t._v("岗位名称："+t._s(t.positionInfo.name))]),a("li",[t._v("上级部门："+t._s(t.positionInfo.departmentName))])]),a("Tree",{ref:"permissionTree",staticClass:"permission-tree",attrs:{data:t.permissionData,"show-checkbox":!0,render:t.permissionRender,"children-key":"menuInfoList"}})],1)],1)},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"titles"},[a("li",[t._v("公司组织结构")]),a("li",[t._v("岗位帐户")])])}],i=(a("4194"),a("fe59"),a("ecb4"),a("ea69"),a("053b"),a("e18c"),a("e35a"),a("9cf3"),a("08ba"),a("80a0")),c=a("e24e"),r=a("2934"),s=a("4ec3"),l=function(t){return Object(r["a"])("".concat(s["f"],"/organizationInfo/getOrganizationList"),t)},d=function(t){return Object(r["a"])("".concat(s["f"],"/roleInfo/getRoleInfoTree"),t)},u=function(t){return Object(r["b"])("".concat(s["f"],"/roleInfo/addRoleInfo"),t)},p=function(t){return Object(r["b"])("".concat(s["f"],"/roleInfo/modifyRoleInfo"),t)},h=function(t){return Object(r["a"])("".concat(s["f"],"/roleInfo/deleteRoleInfo"),t)},f=function(t){return Object(r["b"])("".concat(s["f"],"/roleAccount/addRoleAccount"),t)},m=function(t){return Object(r["b"])("".concat(s["f"],"/menu/menuInfoQueryByOrganizationIds"),t)},y=function(t){return Object(r["b"])("".concat(s["f"],"/roleMenu/addRoleAndMenu"),t)},b=function(t){return Object(r["b"])("".concat(s["f"],"/account/accountQueryRoleList"),t)},v=function(t){return Object(r["b"])("".concat(s["f"],"/account/accountQueryList"),t)},D=a("b962"),g={data:function(){return{showCheckbox:!1,itemTitle:"新增项",accountTitle:"选择帐户",permissionTitle:"配置岗位权限",showItemModal:!1,showDeleteModal:!1,showAccountModal:!1,showPermissionModal:!1,showType:!0,showRoleAccount:!1,search:{accountName:"",phoneNumber:""},positionInfo:{name:"",departmentName:""},accountData:[],roleAccountData:[],selectedData:[],parentData:"",editData:"",deleteData:{root:"",node:"",data:""},itemData:{type:"",roleName:"",roleStatus:"",roleDescribe:""},ruleValidate:{type:[D["a"].select("新增项")[0]],roleName:[D["a"].required("岗位名称")[0]],roleStatus:[D["a"].select("岗位状态")[0]],roleDescribe:[D["a"].required("岗位描述")[0]]},treeData:[],permissionData:[],isCompany:!1}},created:function(){this.initData()},computed:{accountColumns:function(){return[{type:"selection",width:60,align:"center"},{title:"用户帐号",key:"accountName",align:"center"},{title:"手机号码",slot:"phone",align:"center"},{title:"邮箱",key:"accountEmail",align:"center"},{title:"状态",slot:"accountStatus",align:"center"},{title:"帐户类型",slot:"accountType",align:"center"},{title:"创建时间",key:"createDatetime",align:"center"},{title:"创建人",key:"createBy",align:"center"}]},roleAccountColumns:function(){return[{title:"用户帐号",key:"accountName",align:"center"},{title:"手机号码",slot:"phone",align:"center"},{title:"邮箱",key:"accountEmail",align:"center"},{title:"状态",slot:"accountStatus",align:"center"},{title:"帐户类型",key:"accountType",align:"center"},{title:"创建时间",key:"createDatetime",align:"center"},{title:"创建人",key:"createBy",align:"center"}]}},methods:{initData:function(){var t=this;l().then((function(e){var a=e.data;t.treeData=[];var n,o=Object(c["a"])(a);try{var i=function(){var e=n.value;e.render=t.companyRender,e.treeList=[],t.treeData.push(e),d({path:e.organizationId}).then((function(t){var a=t.data;e.treeList=a}))};for(o.s();!(n=o.n()).done;)i()}catch(r){o.e(r)}finally{o.f()}}))},visibleChange:function(t){this.showItemModal=t},deleteVisibleChange:function(t){this.showDeleteModal=t},accountVisibleChange:function(t){this.showAccountModal=t},permissionVisibleChange:function(t){this.showPermissionModal=t},companyRender:function(t,e){var a=this,n=(e.root,e.node,e.data);return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("Icon",{props:{type:"ios-contacts-outline"},style:{marginRight:"8px"}}),t("span",n.organizationName)]),t("span",{style:{display:"inline-block",float:"right",marginRight:"20px"}},[t("Poptip",{props:{disabled:!0,trigger:"hover",placement:"bottom",content:"添加下级"}},[t("Icon",{props:{type:"ios-add"},style:{fontSize:"24px"},on:{click:function(){a.append(n,"company")}}})])])])},positionRender:function(t,e){var a=this,n=e.root,o=e.node,i=e.data;return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("Icon",{props:{type:"ios-contact-outline"},style:{marginRight:"8px"}}),t("span",i.roleName)]),t("span",{style:{display:"inline-block",float:"right",marginRight:"20px"}},[t("Poptip",{props:{disabled:!0,trigger:"hover",placement:"bottom",content:"分配权限"}},[t("Icon",{props:{type:"ios-options-outline"},style:{fontSize:"16px",position:"relative",top:"-2px"},on:{click:function(){a.setPermission(n,o,i)}}})]),t("Poptip",{props:{disabled:!0,trigger:"hover",placement:"bottom",content:"选择帐户"}},[t("Icon",{props:{type:"ios-add"},style:{fontSize:"24px"},on:{click:function(){a.append(i)}}})]),t("Poptip",{props:{disabled:!0,trigger:"hover",placement:"bottom",content:"编辑功能"}},[t("Icon",{props:{type:"md-create"},style:{fontSize:"16px",position:"relative",top:"-3px"},on:{click:function(){a.edit(i)}}})]),t("Poptip",{props:{disabled:!0,trigger:"hover",placement:"bottom",content:"删除功能"}},[t("Icon",{props:{type:"ios-close"},style:{fontSize:"24px"},on:{click:function(){a.remove(n,o,i)}}})])])])},permissionRender:function(t,e){e.root,e.node;var a=e.data;return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("span",a.appName||a.menuName)]),t("span",{style:{display:"inline-block",float:"right",marginRight:"20px"}})])},append:function(t,e){this.$refs.formValidate.fields.forEach((function(t){t.resetField()})),this.itemTitle="新增",this.showItemModal=!0,this.parentData=t,this.itemData.type="",this.showType=!0,e?(this.showType=!1,this.isCompany=!0):this.isCompany=!1},edit:function(t){this.$refs.formValidate.fields.forEach((function(t){t.resetField()})),this.itemTitle="编辑",this.showItemModal=!0,this.editData=t,this.showType=!1,this.itemData.type="",this.itemData.roleName=t.roleName,this.itemData.roleStatus=t.roleStatus,this.itemData.roleDescribe=t.roleDescribe},handleItemModalOk:function(){var t=this;this.$refs.formValidate.validate((function(e){if(e){var a=new Promise((function(e){if(t.showType||t.isCompany)if("1"===t.itemData.type||t.isCompany){var a=Object(i["a"])(Object(i["a"])({},t.itemData),{organizationId:t.parentData.organizationId,rolePid:t.parentData.roleId||0});delete a.type,u({data:a}).then((function(t){t.data;e()}))}else{var n,o=[t.parentData.roleId,[]],r=o[0],s=o[1],l=Object(c["a"])(t.selectedData);try{for(l.s();!(n=l.n()).done;){var d=n.value;if(!d.accountType)return void t.$Message.warning("请给所有选中的帐户选择帐户类型");s.push({roleId:r,accountId:d.accountId,accountType:d.accountType})}}catch(m){l.e(m)}finally{l.f()}s.length?f({data:s}).then((function(t){t.data;e()})):t.$Message.info("请先选择帐户")}else{var h=Object(i["a"])(Object(i["a"])({},t.itemData),{roleId:t.editData.roleId,version:t.editData.version,rolePid:t.editData.rolePid});delete h.type,p({data:h}).then((function(t){t.data;e()}))}}));a.then((function(){t.showItemModal=!1,t.initData()}))}}))},remove:function(t,e,a){this.showDeleteModal=!0,this.deleteData={root:t,node:e,data:a}},handleDeleteModalOk:function(){var t=this,e=this.deleteData.data.roleId,a=new Promise((function(t){h({data:e}).then((function(e){e.data;t()}))}));a.then((function(){t.showDeleteModal=!1;var e=t.deleteData.root.find((function(e){return e===t.deleteData.node})).parent,a=t.deleteData.root.find((function(t){return t.nodeKey===e})).node,n=a.treeList.indexOf(t.deleteData.data);a.treeList.splice(n,1)}))},setPermission:function(t,e,a){var n=this;this.parentData=a;var o=t.find((function(t){return t===e})).parent,i=t.find((function(t){return t.nodeKey===o})).node;this.positionInfo.departmentName=i.roleName||i.organizationName,this.positionInfo.name=a.roleName,m({data:{organizationId:a.organizationId,roleId:a.roleId}}).then((function(t){var e=t.data;n.showPermissionModal=!0,n.permissionData=e}))},handlePermissionModalOk:function(){var t=this,e=this.$refs.permissionTree.getCheckedNodes();if(e.length){var a,n=[],o=Object(c["a"])(e);try{for(o.s();!(a=o.n()).done;){var i=a.value;i.menuId&&n.push({roleId:this.parentData.roleId,menuId:i.menuId})}}catch(r){o.e(r)}finally{o.f()}y({data:n}).then((function(e){e.data;t.showPermissionModal=!1}))}else this.showPermissionModal=!1},searchAccount:function(){var t=this;v({data:Object(i["a"])(Object(i["a"])({},this.search),{},{organizationId:this.parentData.organizationId})}).then((function(e){var a=e.data;t.accountData=a.content}))},selectAccount:function(t){this.selectedData=t},chooseAccountType:function(t,e){this.accountData[e]=t;var a,n=Object(c["a"])(this.selectedData);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(o.accountId===t.accountId){o.accountType=t.accountType;break}}}catch(i){n.e(i)}finally{n.f()}},changeItem:function(t){var e=this;"2"===t&&b({data:{organizationId:this.parentData.organizationId,roleId:this.parentData.roleId,size:"100",direction:"desc"}}).then((function(t){var a=t.data;e.selectedData=[];var n,o=a.content.length>0?a.content:[],i=Object(c["a"])(o);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.accountType&&(r._checked=!0,e.selectedData.push({accountId:r.accountId,accountType:r.accountType}))}}catch(s){i.e(s)}finally{i.f()}e.accountData=o,e.showAccountModal=!0}))},getRoleAccount:function(t){},selectChange:function(t,e){var a=this;e.roleId&&(this.showRoleAccount=!0,b({data:{organizationId:e.organizationId,roleId:e.roleId,size:"100",direction:"desc"}}).then((function(t){var e,n=t.data,o=[],i=n.content.length>0?n.content:[],r=Object(c["a"])(i);try{for(r.s();!(e=r.n()).done;){var s=e.value;if(!s.accountType)break;o.push(s)}}catch(l){r.e(l)}finally{r.f()}a.roleAccountData=o})))}}},I=g,w=(a("bc0a"),a("4023")),k=Object(w["a"])(I,n,o,!1,null,"044032ba",null);e["default"]=k.exports},4194:function(t,e,a){"use strict";var n=a("1c8b"),o=a("5dfd").find,i=a("258f"),c=a("ff9c"),r="find",s=!0,l=c(r);r in[]&&Array(1)[r]((function(){s=!1})),n({target:"Array",proto:!0,forced:s||!l},{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),i(r)},bc0a:function(t,e,a){"use strict";var n=a("e7b6"),o=a.n(n);o.a},e7b6:function(t,e,a){}}]);